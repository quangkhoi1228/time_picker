var stepsOfClockLocation = {
    "locationForHours" : [
        {"xHour" : 1, "yHour" : 1, "distanceCursor" : 1},
        {"xHour" : 2, "yHour" : 2, "distanceCursor" : 2},
        {"xHour" : 3, "yHour" : 3, "distanceCursor" : 3},
        {"xHour" : 4, "yHour" : 4, "distanceCursor" : 4},
        {"xHour" : 5, "yHour" : 5, "distanceCursor" : 5},
        {"xHour" : 6, "yHour" : 6, "distanceCursor" : 6},
        {"xHour" : 7, "yHour" : 7, "distanceCursor" : 7},
        {"xHour" : 8, "yHour" : 8, "distanceCursor" : 8},
        {"xHour" : 9, "yHour" : 9, "distanceCursor" : 9},
        {"xHour" : 10, "yHour" : 10, "distanceCursor" : 10},
        {"xHour" : 11, "yHour" : 11, "distanceCursor" : 11},
        {"xHour" : 12, "yHour" : 12, "distanceCursor" : 12},
    ],

    "locationForMinutes" : [
        {"xMinute" : 1, "yMinute" : 1, "distanceCursor" : 1},
        {"xMinute" : 2, "yMinute" : 2, "distanceCursor" : 2},
        {"xMinute" : 3, "yMinute" : 3, "distanceCursor" : 3},
        {"xMinute" : 4, "yMinute" : 4, "distanceCursor" : 4},
        {"xMinute" : 5, "yMinute" : 5, "distanceCursor" : 5},
        {"xMinute" : 6, "yMinute" : 6, "distanceCursor" : 6},
        {"xMinute" : 7, "yMinute" : 7, "distanceCursor" : 7},
        {"xMinute" : 8, "yMinute" : 8, "distanceCursor" : 8},
        {"xMinute" : 9, "yMinute" : 9, "distanceCursor" : 9},
        {"xMinute" : 10, "yMinute" : 10, "distanceCursor" : 10},
        {"xMinute" : 11, "yMinute" : 11, "distanceCursor" : 11},
        {"xMinute" : 12, "yMinute" : 12, "distanceCursor" : 12},
        {"xMinute" : 13, "yMinute" : 13, "distanceCursor" : 13},
        {"xMinute" : 14, "yMinute" : 14, "distanceCursor" : 14},
        {"xMinute" : 15, "yMinute" : 15, "distanceCursor" : 15},
        {"xMinute" : 16, "yMinute" : 16, "distanceCursor" : 16},
        {"xMinute" : 17, "yMinute" : 17, "distanceCursor" : 17},
        {"xMinute" : 18, "yMinute" : 18, "distanceCursor" : 18},
        {"xMinute" : 19, "yMinute" : 19, "distanceCursor" : 19},
        {"xMinute" : 20, "yMinute" : 20, "distanceCursor" : 20},
        {"xMinute" : 21, "yMinute" : 21, "distanceCursor" : 21},
        {"xMinute" : 22, "yMinute" : 22, "distanceCursor" : 22},
        {"xMinute" : 23, "yMinute" : 23, "distanceCursor" : 23},
        {"xMinute" : 24, "yMinute" : 24, "distanceCursor" : 24},
        {"xMinute" : 25, "yMinute" : 25, "distanceCursor" : 25},
        {"xMinute" : 26, "yMinute" : 26, "distanceCursor" : 26},
        {"xMinute" : 27, "yMinute" : 27, "distanceCursor" : 27},
        {"xMinute" : 28, "yMinute" : 28, "distanceCursor" : 28},
        {"xMinute" : 29, "yMinute" : 29, "distanceCursor" : 29},
        {"xMinute" : 30, "yMinute" : 30, "distanceCursor" : 30},
        {"xMinute" : 31, "yMinute" : 31, "distanceCursor" : 31},
        {"xMinute" : 32, "yMinute" : 32, "distanceCursor" : 32},
        {"xMinute" : 33, "yMinute" : 33, "distanceCursor" : 33},
        {"xMinute" : 34, "yMinute" : 34, "distanceCursor" : 34},
        {"xMinute" : 35, "yMinute" : 35, "distanceCursor" : 35},
        {"xMinute" : 36, "yMinute" : 36, "distanceCursor" : 36},
        {"xMinute" : 37, "yMinute" : 37, "distanceCursor" : 37},
        {"xMinute" : 38, "yMinute" : 38, "distanceCursor" : 38},
        {"xMinute" : 39, "yMinute" : 39, "distanceCursor" : 39},
        {"xMinute" : 40, "yMinute" : 40, "distanceCursor" : 40},
        {"xMinute" : 41, "yMinute" : 41, "distanceCursor" : 41},
        {"xMinute" : 42, "yMinute" : 42, "distanceCursor" : 42},
        {"xMinute" : 43, "yMinute" : 43, "distanceCursor" : 43},
        {"xMinute" : 44, "yMinute" : 44, "distanceCursor" : 44},
        {"xMinute" : 45, "yMinute" : 45, "distanceCursor" : 45},
        {"xMinute" : 46, "yMinute" : 46, "distanceCursor" : 46},
        {"xMinute" : 47, "yMinute" : 47, "distanceCursor" : 47},
        {"xMinute" : 48, "yMinute" : 48, "distanceCursor" : 48},
        {"xMinute" : 49, "yMinute" : 49, "distanceCursor" : 49},
        {"xMinute" : 50, "yMinute" : 50, "distanceCursor" : 50},
        {"xMinute" : 51, "yMinute" : 51, "distanceCursor" : 51},
        {"xMinute" : 52, "yMinute" : 52, "distanceCursor" : 52},
        {"xMinute" : 53, "yMinute" : 53, "distanceCursor" : 53},
        {"xMinute" : 54, "yMinute" : 54, "distanceCursor" : 54},
        {"xMinute" : 55, "yMinute" : 55, "distanceCursor" : 55},
        {"xMinute" : 56, "yMinute" : 56, "distanceCursor" : 56},
        {"xMinute" : 57, "yMinute" : 57, "distanceCursor" : 57},
        {"xMinute" : 58, "yMinute" : 58, "distanceCursor" : 58},
        {"xMinute" : 59, "yMinute" : 59, "distanceCursor" : 59},
        {"xMinute" : 60, "yMinute" : 60, "distanceCursor" : 60},
    ]
}

var time_picker = {
    createStructure: function () {
        time_picker.createHourStructure();
        time_picker.createMinuteStructure();
    },
    openModal: function () {
        var button = document.querySelector('#launchModal');
        var modal = document.querySelector('.modal');
        var count = 0;
        button.onclick = function () {
            modal.classList.add('is-active');
            time_picker.addHourLocation();
            time_picker.addMinuteLocation();
            if (count == 0) {
                document.getElementById("saveHour12").click();
                document.getElementById("saveMinute60").click();
                count++;
            } else {
                var switchHour = document.getElementById("hour");
                var switchMinute = document.getElementById("minute");
                var switchHourText = document.getElementById("in-hour");
                var switchMinuteText = document.getElementById("in-minute");
    
                switchHourText.style.display = "block";
                switchMinuteText.style.display = "none";
                switchHour.style.display = "block";
                switchMinute.style.display = "none";
            }
        }
    },
    closeModal: function () {
        var background = document.querySelector('.modal-background');
        var modal = document.querySelector('.modal');
        background.onclick = function () {
            modal.classList.remove('is-active');
        }
    },
    normalizeNumber: function (number) {
        if (number < 10) {
            number = '0' + number;
        }
        return number;
    },
    switchSession: function () {
        var button = document.querySelector('.time-showing-session');
        button.onclick = function () {
            var switchAM = document.getElementById("outputSessionAM");
            var switchPM = document.getElementById("outputSessionPM");

            if (switchAM.style.display == "none") {
                switchAM.style.display = "block";
                switchPM.style.display = "none";
            } else {
                switchAM.style.display = "none";
                switchPM.style.display = "block";
            }
        }
    },
    switchHour: function () {
        var button = document.querySelector('.time-oclock .hourMode');
        button.onclick = function () {
            var switchHour = document.getElementById("hour");
            var switchMinute = document.getElementById("minute");
            var switchHourText = document.getElementById("in-hour");
            var switchMinuteText = document.getElementById("in-minute");

            switchHourText.style.display = "block";
            switchMinuteText.style.display = "none";
            switchHour.style.display = "block";
            switchMinute.style.display = "none";
        }
    },
    switchMinute: function () {
        var button = document.querySelector('.time-oclock .minuteMode');
        button.onclick = function () {
            var switchHour = document.getElementById("hour");
            var switchMinute = document.getElementById("minute");
            var switchHourText = document.getElementById("in-hour");
            var switchMinuteText = document.getElementById("in-minute");

            switchHourText.style.display = "none";
            switchMinuteText.style.display = "block";
            switchHour.style.display = "none";
            switchMinute.style.display = "block";
        }
    },
    createHourStructure: function () {
        var container = document.getElementById('hour');
        for (var number = 1; number <= 12; number++) {
            var button = document.createElement('button');
            button.setAttribute('class', 'oclock-' + number);
            button.setAttribute('id', 'saveHour' + time_picker.normalizeNumber(number));
            button.setAttribute('value', time_picker.normalizeNumber(number));
            button.setAttribute('data-color', 'blue');


            var div = document.createElement('div');
            div.setAttribute('id', 'blueHour' + time_picker.normalizeNumber(number));
            button.appendChild(div);

            var p = document.createElement('p');
            p.innerHTML = number;
            div.appendChild(p);

            container.appendChild(button);
            time_picker.addEventHourButton(button, number);
        }
    },
    createMinuteStructure: function () {
        time_picker.createBigStepMinuteStructure();
        time_picker.createSmallStepMinuteStructure();
    },
    createBigStepMinuteStructure: function () {
        var bigStepsContainer = document.querySelector('#minute .big-steps');
        for (var number = 1; number <= 12; number++) {
            var button = document.createElement('button');
            button.setAttribute('class', 'oclock-' + number);
            button.setAttribute('id', 'saveMinute' + time_picker.normalizeNumber(number * 5));
            var value = (number * 5 == 60) ? 0 : (number * 5);
            
            button.setAttribute('value', value);
            button.setAttribute('data-color', 'blue');

            var div = document.createElement('div');
            div.setAttribute('id', 'blueMinute' + time_picker.normalizeNumber(number * 5));
            button.appendChild(div);

            var p = document.createElement('p');
            p.innerHTML = value;
            div.appendChild(p);

            bigStepsContainer.appendChild(button);
            time_picker.addEventBigStepMinuteButton(button, number);
        }
    },
    createSmallStepMinuteStructure: function () {
        var smallStepsContainer = document.querySelector('#minute .small-steps');
        for (var number = 1; number < 60; number++) {
            if (number % 5 != 0) {
                var button = document.createElement('button');
                button.setAttribute('class', 'minute-step' + number);
                button.setAttribute('id', 'saveMinute' + time_picker.normalizeNumber(number));
                button.setAttribute('value', time_picker.normalizeNumber(number));
                button.setAttribute('data-color', 'blue');

                var div = document.createElement('div');
                div.setAttribute('id', 'blueMinute' + time_picker.normalizeNumber(number));
                button.appendChild(div);

                var p = document.createElement('p');
                div.appendChild(p);
                smallStepsContainer.appendChild(button);
                time_picker.addEventSmallStepMinuteButton(button, number);
            }
        }
    },
    addEventHourButton: function (button, number) {
        button.addEventListener("click", function () {
            var hourHandle = document.getElementById("hourHandle");
            hourHandle.style.transform = `translate(-50%, -50%) rotate(${number * 30}deg)`;
            document.getElementById("outputHour").innerHTML = button.getAttribute('value');
            for (var numberHighlight = 1; numberHighlight <= 12; numberHighlight ++) {
                var highlightContainer = document.querySelector('#blueHour' + time_picker.normalizeNumber(numberHighlight));
                highlightContainer.classList.remove('highlight');
            }
            button.querySelector('div').classList.add('highlight');
        });
    },
    addEventBigStepMinuteButton: function (button, number) {
        button.addEventListener("click", function () {
            var minuteHandle = document.getElementById("minuteHandle");
            minuteHandle.style.transform = `translate(-50%, -50%) rotate(${number * 30}deg)`;
            document.getElementById("outputMinute").innerHTML = time_picker.normalizeNumber(button.getAttribute('value'));
            for (var numberHighlight = 1; numberHighlight <= 12; numberHighlight ++) {
                var highlightContainer = document.querySelector('#blueMinute' + time_picker.normalizeNumber(numberHighlight*5));
                highlightContainer.classList.remove('highlight');
            }
            button.querySelector('div').classList.add('highlight');
        });
    },
    addEventSmallStepMinuteButton: function (button, number) {
        button.addEventListener("click", function () {
            var minuteHandle = document.getElementById("minuteHandle");
            minuteHandle.style.transform = `translate(-50%, -50%) rotate(${number * 6}deg)`;
            document.getElementById("outputMinute").innerHTML = button.getAttribute('value');
            for (var numberHighlight = 1; numberHighlight <= 60; numberHighlight ++) {
                var highlightContainer = document.querySelector('#blueMinute' + time_picker.normalizeNumber(numberHighlight));
                highlightContainer.classList.remove('highlight');
            }
        });
    },
    setupClockFeature: function () {
        time_picker.switchSession();
        time_picker.switchHour();
        time_picker.switchMinute();
        time_picker.saveTimeButton();
        time_picker.clearTimeButton();
        time_picker.clickOnClock();
    },
    saveTimeButton: function () {
        var button = document.querySelector('.time-picker-buttons#saveTime');
        button.onclick = function () {
            var hour = document.getElementById("outputHour");
            var minute = document.getElementById("outputMinute");
            var outputSessionAM = document.getElementById("outputSessionAM");
            var outputSessionPM = document.getElementById("outputSessionPM");

            var modal = document.querySelector('.modal');
            modal.classList.remove('is-active');

            if (outputSessionAM.style.display == "none") {
                document.getElementById("resultSession").innerHTML = outputSessionPM.innerText;
            } else {
                document.getElementById("resultSession").innerHTML = outputSessionAM.innerText;
            }
            document.getElementById("resultHour").innerHTML = hour.innerText;
            document.getElementById("resultMinute").innerHTML = minute.innerText;
        }
    },
    clearTimeButton: function () {
        var button = document.querySelector('.time-picker-buttons#clearTime');
        button.onclick = function () {
            var switchHour = document.getElementById("hour");
            var switchMinute = document.getElementById("minute");
            var switchHourText = document.getElementById("in-hour");
            var switchMinuteText = document.getElementById("in-minute");
    
            switchHourText.style.display = "block";
            switchMinuteText.style.display = "none";
            switchHour.style.display = "block";
            switchMinute.style.display = "none";

            document.getElementById("saveHour12").click();
            document.getElementById("saveMinute60").click();
        }
    },
    clickOnClock: function () {
        var moveHourPointer = document.getElementById("hour");
        var moveMinutePointer = document.getElementById("minute");

        moveHourPointer.onmousedown = function() {
            moveHourPointer.style.cursor = "move";
            time_picker.beginControlHourMouseDown();
        }
        moveHourPointer.onmouseup = function() {
            moveHourPointer.style.cursor = "default";
            time_picker.stopControlHourMouseDown();
        }

        moveMinutePointer.onmousedown = function() {
            moveMinutePointer.style.cursor = "move";
            time_picker.beginControlMinuteMouseDown();
        }
        moveMinutePointer.onmouseup = function() {
            moveMinutePointer.style.cursor = "default";
            time_picker.stopControlMinuteMouseDown();
        }
    },
    addHourLocation: function () {
        for (var index = 0; index < 12; index++) {
            var numberHour = index+1;
            var xDefault = 1;
            var yDefault = 1;

            xDefault = document.querySelector('#blueHour'+time_picker.normalizeNumber(numberHour)).getBoundingClientRect().left + window.scrollX;
            yDefault = document.querySelector('#blueHour'+time_picker.normalizeNumber(numberHour)).getBoundingClientRect().top + window.scrollY;

            stepsOfClockLocation.locationForHours[index].xHour = xDefault;
            stepsOfClockLocation.locationForHours[index].yHour = yDefault;
        }
    },
    beginControlHourMouseDown: function () {
        var moveHourPointer = document.getElementById("hour");
        moveHourPointer.onmousemove = time_picker.locateHourCursorDown();
    },
    locateHourCursorDown: function () {    
        document.onmousemove = function(eventData){
            xCursor = eventData.pageX;
            yCursor = eventData.pageY;

            var distanceFromHourToCursor = 1;
            var minDistanceHour = 10000;
            var hourChosen = 0;   

            for (var index = 0; index < 12; index++) {
                distanceFromHourToCursor = Math.sqrt((stepsOfClockLocation.locationForHours[index].xHour - xCursor)**2 
                                                    + (stepsOfClockLocation.locationForHours[index].yHour - yCursor)**2);
                stepsOfClockLocation.locationForHours[index].distanceCursor = distanceFromHourToCursor;

                if (stepsOfClockLocation.locationForHours[index].distanceCursor < minDistanceHour) {
                    minDistanceHour = stepsOfClockLocation.locationForHours[index].distanceCursor;
                    hourChosen = index + 1;
                    document.getElementById("saveHour"+time_picker.normalizeNumber(hourChosen)).click();              
                }
            }
        }
    },
    stopControlHourMouseDown: function () {
        var moveHourPointer = document.getElementById("hour");
        moveHourPointer.onmousemove = time_picker.locateHourCursorUp();
    },
    locateHourCursorUp: function () {
        document.onmousemove = null;
    },
    addMinuteLocation: function () {
        for (var index = 0; index < 60; index++) {
            var numberMinute = index+1;
            var xDefault = 1;
            var yDefault = 1;

            xDefault = document.querySelector('#blueMinute'+time_picker.normalizeNumber(numberMinute)).getBoundingClientRect().left + window.scrollX;
            yDefault = document.querySelector('#blueMinute'+time_picker.normalizeNumber(numberMinute)).getBoundingClientRect().top + window.scrollY;

            stepsOfClockLocation.locationForMinutes[index].xMinute = xDefault;
            stepsOfClockLocation.locationForMinutes[index].yMinute = yDefault;
        }
    },
    beginControlMinuteMouseDown: function () {
        var moveHourPointer = document.getElementById("minute");
        moveHourPointer.onmousemove = time_picker.locateMinuteCursorDown();
    },
    locateMinuteCursorDown: function () {    
        document.onmousemove = function(eventData){
            xCursor = eventData.pageX;
            yCursor = eventData.pageY;

            var distanceFromMinuteToCursor = 1;
            var minDistanceMinute = 10000;
            var minuteChosen = 0;   

            for (var index = 0; index < 60; index++) {
                distanceFromMinuteToCursor = Math.sqrt((stepsOfClockLocation.locationForMinutes[index].xMinute - xCursor)**2 
                                                    + (stepsOfClockLocation.locationForMinutes[index].yMinute - yCursor)**2);
                stepsOfClockLocation.locationForMinutes[index].distanceCursor = distanceFromMinuteToCursor;

                if (stepsOfClockLocation.locationForMinutes[index].distanceCursor < minDistanceMinute) {
                    minDistanceMinute = stepsOfClockLocation.locationForMinutes[index].distanceCursor;
                    minuteChosen = index + 1;
                    document.getElementById("saveMinute"+time_picker.normalizeNumber(minuteChosen)).click();              
                }
            }
        }
    },
    stopControlMinuteMouseDown: function () {
        var moveHourPointer = document.getElementById("minute");
        moveHourPointer.onmousemove = time_picker.locateMinuteCursorUp();
    },
    locateMinuteCursorUp: function () {
        document.onmousemove = null;
    },
};